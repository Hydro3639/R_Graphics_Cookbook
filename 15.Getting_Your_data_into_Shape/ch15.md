# chapter15: Getting Your Data into Shape

```r
library(gcookbook)  # For the data set
head(heightweight)
```

```
##   sex ageYear ageMonth heightIn weightLb
## 1   f   11.92      143     56.3     85.0
## 2   f   12.92      155     62.3    105.0
## 3   f   12.75      153     63.3    108.0
## 4   f   13.42      161     59.0     92.0
## 5   f   15.92      191     62.5    112.5
## 6   f   14.25      171     62.5    112.0
```

```r

str(heightweight)
```

```
## 'data.frame':	236 obs. of  5 variables:
##  $ sex     : Factor w/ 2 levels "f","m": 1 1 1 1 1 1 1 1 1 1 ...
##  $ ageYear : num  11.9 12.9 12.8 13.4 15.9 ...
##  $ ageMonth: int  143 155 153 161 191 171 185 142 160 140 ...
##  $ heightIn: num  56.3 62.3 63.3 59 62.5 62.5 59 56.5 62 53.8 ...
##  $ weightLb: num  85 105 108 92 112 ...
```

## 15.1.Creating a Data Frame

```r
# Two starting vectors
g <- c("A", "B", "C")
x <- 1:3

dat <- data.frame(g, x)
dat
```

```
##   g x
## 1 A 1
## 2 B 2
## 3 C 3
```

## 15.2.Getting Information About a Data Structture    

```r
lst <- list(group = g, value = x)  # A list of vectors

dat <- as.data.frame(lst)

str(ToothGrowth)
```

```
## 'data.frame':	60 obs. of  3 variables:
##  $ len : num  4.2 11.5 7.3 5.8 6.4 10 11.2 11.2 5.2 7 ...
##  $ supp: Factor w/ 2 levels "OJ","VC": 2 2 2 2 2 2 2 2 2 2 ...
##  $ dose: num  0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 ...
```

```r

tg <- ToothGrowth
tg$supp <- as.character(tg$supp)

str(tg)
```

```
## 'data.frame':	60 obs. of  3 variables:
##  $ len : num  4.2 11.5 7.3 5.8 6.4 10 11.2 11.2 5.2 7 ...
##  $ supp: chr  "VC" "VC" "VC" "VC" ...
##  $ dose: num  0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 ...
```

```r

# Print out the columns by themselves

# From old data frame (factor)
ToothGrowth$supp
```

```
##  [1] VC VC VC VC VC VC VC VC VC VC VC VC VC VC VC VC VC VC VC VC VC VC VC
## [24] VC VC VC VC VC VC VC OJ OJ OJ OJ OJ OJ OJ OJ OJ OJ OJ OJ OJ OJ OJ OJ
## [47] OJ OJ OJ OJ OJ OJ OJ OJ OJ OJ OJ OJ OJ OJ
## Levels: OJ VC
```

```r

# From new data frame (character)
tg$supp
```

```
##  [1] "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC"
## [15] "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC" "VC"
## [29] "VC" "VC" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ"
## [43] "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ" "OJ"
## [57] "OJ" "OJ" "OJ" "OJ"
```

## 15.3.Adding a Column to a Data Frame

```r
# data$newcol <- NA
dat$newcol <- NA

# data$newcol <- vec
dat$newcol <- vec
```

```
## Error: 找不到对象'vec'
```

## 15.4.Deleting a Column from a Data Frame

```r
data$badcol <- NULL
```

```
## Error: 类别为'closure'的对象不可以取子集
```

```r

# Return data without badcol
data <- subset(data, select = -badcol)
```

```
## Error: 缺少参数"subset",也没有缺省值
```

```r

# Exclude badcol and othercol
data <- subset(data, select = c(-badcol, -othercol))
```

```
## Error: 缺少参数"subset",也没有缺省值
```

## 15.5.Renaming Columns in a Data Frame

```r
names(dat) <- c("name1", "name2", "name3")

library(gcookbook)  # For the data set
names(anthoming)  # Print the names of the columns
```

```
## [1] "angle" "expt"  "ctrl"
```

```r

names(anthoming)[names(anthoming) == "ctrl"] <- c("Control")
names(anthoming)[names(anthoming) == "expt"] <- c("Experimental")
names(anthoming)
```

```
## [1] "angle"        "Experimental" "Control"
```

```r

names(anthoming)[1] <- "Angle"
names(anthoming)
```

```
## [1] "Angle"        "Experimental" "Control"
```

## 15.6.Reordering Columns in a Data Frame

```r
dat <- dat[c(1, 3, 2)]

dat <- dat[c("col1", "col3", "col2")]
```

```
## Error: undefined columns selected
```

```r

library(gcookbook)  # For the data set
anthoming
```

```
##   Angle Experimental Control
## 1   -20            1       0
## 2   -10            7       3
## 3     0            2       3
## 4    10            0       3
## 5    20            0       1
```

```r

anthoming[c(1, 3, 2)]  # List-style indexing
```

```
##   Angle Control Experimental
## 1   -20       0            1
## 2   -10       3            7
## 3     0       3            2
## 4    10       3            0
## 5    20       1            0
```

```r

# Putting nothing before the comma means to select all rows
anthoming[, c(1, 3, 2)]  # Matrix-style indexing
```

```
##   Angle Control Experimental
## 1   -20       0            1
## 2   -10       3            7
## 3     0       3            2
## 4    10       3            0
## 5    20       1            0
```

```r

anthoming[3]  # List-style indexing
```

```
##   Control
## 1       0
## 2       3
## 3       3
## 4       3
## 5       1
```

```r

anthoming[, 3]  # Matrix-style indexing
```

```
## [1] 0 3 3 3 1
```

```r

anthoming[, 3, drop = FALSE]  # Matrix-style indexing with drop=FALSE
```

```
##   Control
## 1       0
## 2       3
## 3       3
## 4       3
## 5       1
```

## 15.7.Getting a Subset of a Data Frame

```r
library(gcookbook)  # For the data set
head(climate)
```

```
##     Source Year Anomaly1y Anomaly5y Anomaly10y Unc10y
## 1 Berkeley 1800        NA        NA     -0.435  0.505
## 2 Berkeley 1801        NA        NA     -0.453  0.493
## 3 Berkeley 1802        NA        NA     -0.460  0.486
## 4 Berkeley 1803        NA        NA     -0.493  0.489
## 5 Berkeley 1804        NA        NA     -0.536  0.483
## 6 Berkeley 1805        NA        NA     -0.541  0.475
```

```r

head(subset(climate, Source == "Berkeley", select = c(Year, Anomaly10y)))
```

```
##   Year Anomaly10y
## 1 1800     -0.435
## 2 1801     -0.453
## 3 1802     -0.460
## 4 1803     -0.493
## 5 1804     -0.536
## 6 1805     -0.541
```

```r

head(subset(climate, Source == "Berkeley" & Year >= 1900 & Year <= 2000, select = c(Year, 
    Anomaly10y)))
```

```
##     Year Anomaly10y
## 101 1900     -0.171
## 102 1901     -0.162
## 103 1902     -0.177
## 104 1903     -0.199
## 105 1904     -0.223
## 106 1905     -0.241
```

```r

head(climate[climate$Source == "Berkeley" & climate$Year >= 1900 & climate$Year <= 
    2000, c("Year", "Anomaly10y")])
```

```
##     Year Anomaly10y
## 101 1900     -0.171
## 102 1901     -0.162
## 103 1902     -0.177
## 104 1903     -0.199
## 105 1904     -0.223
## 106 1905     -0.241
```

```r


head(climate[climate$Source == "Berkeley" & climate$Year >= 1900 & climate$Year <= 
    2000, c("Year", "Anomaly10y"), drop = FALSE])
```

```
##     Year Anomaly10y
## 101 1900     -0.171
## 102 1901     -0.162
## 103 1902     -0.177
## 104 1903     -0.199
## 105 1904     -0.223
## 106 1905     -0.241
```

```r


head(climate[1:100, c(2, 5)])
```

```
##   Year Anomaly10y
## 1 1800     -0.435
## 2 1801     -0.453
## 3 1802     -0.460
## 4 1803     -0.493
## 5 1804     -0.536
## 6 1805     -0.541
```

## 15.8.Changing the Order of Factor Levels  

```r
# By default, levels are ordered alphabetically
sizes <- factor(c("small", "large", "large", "small", "medium"))
sizes
```

```
## [1] small  large  large  small  medium
## Levels: large medium small
```

```r

# Change the order of levels
sizes <- factor(sizes, levels = c("small", "medium", "large"))
sizes
```

```
## [1] small  large  large  small  medium
## Levels: small medium large
```

```r

factor(sizes, levels = rev(levels(sizes)))
```

```
## [1] small  large  large  small  medium
## Levels: large medium small
```

## 15.9.Changing the Order of Factor Levels Based on Data Values

```r
# Make a copy since we'll modify it
iss <- InsectSprays
iss$spray
```

```
##  [1] A A A A A A A A A A A A B B B B B B B B B B B B C C C C C C C C C C C
## [36] C D D D D D D D D D D D D E E E E E E E E E E E E F F F F F F F F F F
## [71] F F
## Levels: A B C D E F
```

```r

iss$spray <- reorder(iss$spray, iss$count, FUN = mean)
iss$spray
```

```
##  [1] A A A A A A A A A A A A B B B B B B B B B B B B C C C C C C C C C C C
## [36] C D D D D D D D D D D D D E E E E E E E E E E E E F F F F F F F F F F
## [71] F F
## attr(,"scores")
##      A      B      C      D      E      F 
## 14.500 15.333  2.083  4.917  3.500 16.667 
## Levels: C E D A B F
```

```r

attr(, "scores")
```

```
## Error: 1元素是空的
```

## 15.10.Changing the Names of Factor Levels

```r
sizes <- factor(c("small", "large", "large", "small", "medium"))
sizes
```

```
## [1] small  large  large  small  medium
## Levels: large medium small
```

```r

levels(sizes)
```

```
## [1] "large"  "medium" "small"
```

```r

# With revalue(), pass it a named vector with the mappings
sizes1 <- revalue(sizes, c(small = "S", medium = "M", large = "L"))
```

```
## Error: 没有"revalue"这个函数
```

```r
sizes1
```

```
## Error: 找不到对象'sizes1'
```

```r

# Can also use quotes -- useful if there are spaces or other strange
# characters
revalue(sizes, c(small = "S", medium = "M", large = "L"))
```

```
## Error: 没有"revalue"这个函数
```

```r

# mapvalues() lets you use two separate vectors instead of a named vector
mapvalues(sizes, c("small", "medium", "large"), c("S", "M", "L"))
```

```
## Error: 没有"mapvalues"这个函数
```

```r

sizes <- factor(c("small", "large", "large", "small", "medium"))

# Index into the levels and rename each one
levels(sizes)[levels(sizes) == "large"] <- "L"
levels(sizes)[levels(sizes) == "medium"] <- "M"
levels(sizes)[levels(sizes) == "small"] <- "S"
sizes
```

```
## [1] S L L S M
## Levels: L M S
```

```r

sizes <- factor(c("small", "large", "large", "small", "medium"))
levels(sizes) <- list(S = "small", M = "medium", L = "large")
sizes
```

```
## [1] S L L S M
## Levels: S M L
```

```r

# By default, levels are ordered alphabetically
sizes <- factor(c("small", "large", "large", "small", "medium"))

levels(sizes)[1] <- "L"
sizes
```

```
## [1] small  L      L      small  medium
## Levels: L medium small
```

```r

# Rename all levels at once
levels(sizes) <- c("L", "M", "S")
sizes
```

```
## [1] S L L S M
## Levels: L M S
```

## 15.11.Removing Unused Levels from a Factor 

```r
sizes <- factor(c("small", "large", "large", "small", "medium"))
sizes <- sizes[1:3]
sizes
```

```
## [1] small large large
## Levels: large medium small
```

```r

sizes <- droplevels(sizes)
sizes
```

```
## [1] small large large
## Levels: large small
```

## 15.12.Changing the Names of Items in a Character Vector 

```r
sizes <- c("small", "large", "large", "small", "medium")
sizes
```

```
## [1] "small"  "large"  "large"  "small"  "medium"
```

```r

# With revalue(), pass it a named vector with the mappings
sizes1 <- revalue(sizes, c(small = "S", medium = "M", large = "L"))
```

```
## Error: 没有"revalue"这个函数
```

```r
sizes1
```

```
## Error: 找不到对象'sizes1'
```

```r

# Can also use quotes -- useful if there are spaces or other strange
# characters
revalue(sizes, c(small = "S", medium = "M", large = "L"))
```

```
## Error: 没有"revalue"这个函数
```

```r

# mapvalues() lets you use two separate vectors instead of a named vector
mapvalues(sizes, c("small", "medium", "large"), c("S", "M", "L"))
```

```
## Error: 没有"mapvalues"这个函数
```

```r

sizes <- c("small", "large", "large", "small", "medium")
sizes
```

```
## [1] "small"  "large"  "large"  "small"  "medium"
```

```r

sizes[sizes == "small"] <- "S"
sizes[sizes == "medium"] <- "M"
sizes[sizes == "large"] <- "L"

sizes
```

```
## [1] "S" "L" "L" "S" "M"
```

## 15.13.Recoding a Categorical Variable to Another Categorical Variable

```r
# Work on a subset of the PlantGrowth data set
pg <- PlantGrowth[c(1, 2, 11, 21, 22), ]
pg
```

```
##    weight group
## 1    4.17  ctrl
## 2    5.58  ctrl
## 11   4.81  trt1
## 21   6.31  trt2
## 22   5.12  trt2
```

```r

pg <- PlantGrowth

oldvals <- c("ctrl", "trt1", "trt2")
newvals <- factor(c("No", "Yes", "Yes"))

pg$treatment <- newvals[match(pg$group, oldvals)]

pg$treatment[pg$group == "ctrl"] <- "no"
```

```
## Warning: invalid factor level, NA generated
```

```r
pg$treatment[pg$group == "trt1"] <- "yes"
```

```
## Warning: invalid factor level, NA generated
```

```r
pg$treatment[pg$group == "trt2"] <- "yes"
```

```
## Warning: invalid factor level, NA generated
```

```r

# Convert to a factor
pg$treatment <- factor(pg$treatment)
pg
```

```
##    weight group treatment
## 1    4.17  ctrl      <NA>
## 2    5.58  ctrl      <NA>
## 3    5.18  ctrl      <NA>
## 4    6.11  ctrl      <NA>
## 5    4.50  ctrl      <NA>
## 6    4.61  ctrl      <NA>
## 7    5.17  ctrl      <NA>
## 8    4.53  ctrl      <NA>
## 9    5.33  ctrl      <NA>
## 10   5.14  ctrl      <NA>
## 11   4.81  trt1      <NA>
## 12   4.17  trt1      <NA>
## 13   4.41  trt1      <NA>
## 14   3.59  trt1      <NA>
## 15   5.87  trt1      <NA>
## 16   3.83  trt1      <NA>
## 17   6.03  trt1      <NA>
## 18   4.89  trt1      <NA>
## 19   4.32  trt1      <NA>
## 20   4.69  trt1      <NA>
## 21   6.31  trt2      <NA>
## 22   5.12  trt2      <NA>
## 23   5.54  trt2      <NA>
## 24   5.50  trt2      <NA>
## 25   5.37  trt2      <NA>
## 26   5.29  trt2      <NA>
## 27   4.92  trt2      <NA>
## 28   6.15  trt2      <NA>
## 29   5.80  trt2      <NA>
## 30   5.26  trt2      <NA>
```

```r

pg$newcol[pg$group == "ctrl" & pg$weight < 5] <- "no_small"
pg$newcol[pg$group == "ctrl" & pg$weight >= 5] <- "no_large"
pg$newcol[pg$group == "trt1"] <- "yes"
pg$newcol[pg$group == "trt2"] <- "yes"

pg$newcol <- factor(pg$newcol)
pg
```

```
##    weight group treatment   newcol
## 1    4.17  ctrl      <NA> no_small
## 2    5.58  ctrl      <NA> no_large
## 3    5.18  ctrl      <NA> no_large
## 4    6.11  ctrl      <NA> no_large
## 5    4.50  ctrl      <NA> no_small
## 6    4.61  ctrl      <NA> no_small
## 7    5.17  ctrl      <NA> no_large
## 8    4.53  ctrl      <NA> no_small
## 9    5.33  ctrl      <NA> no_large
## 10   5.14  ctrl      <NA> no_large
## 11   4.81  trt1      <NA>      yes
## 12   4.17  trt1      <NA>      yes
## 13   4.41  trt1      <NA>      yes
## 14   3.59  trt1      <NA>      yes
## 15   5.87  trt1      <NA>      yes
## 16   3.83  trt1      <NA>      yes
## 17   6.03  trt1      <NA>      yes
## 18   4.89  trt1      <NA>      yes
## 19   4.32  trt1      <NA>      yes
## 20   4.69  trt1      <NA>      yes
## 21   6.31  trt2      <NA>      yes
## 22   5.12  trt2      <NA>      yes
## 23   5.54  trt2      <NA>      yes
## 24   5.50  trt2      <NA>      yes
## 25   5.37  trt2      <NA>      yes
## 26   5.29  trt2      <NA>      yes
## 27   4.92  trt2      <NA>      yes
## 28   6.15  trt2      <NA>      yes
## 29   5.80  trt2      <NA>      yes
## 30   5.26  trt2      <NA>      yes
```

```r

pg$weighttrt <- interaction(pg$weightcat, pg$treatment)
```

```
## Error: 替换数据里有0行，但数据有30
```

```r
pg
```

```
##    weight group treatment   newcol
## 1    4.17  ctrl      <NA> no_small
## 2    5.58  ctrl      <NA> no_large
## 3    5.18  ctrl      <NA> no_large
## 4    6.11  ctrl      <NA> no_large
## 5    4.50  ctrl      <NA> no_small
## 6    4.61  ctrl      <NA> no_small
## 7    5.17  ctrl      <NA> no_large
## 8    4.53  ctrl      <NA> no_small
## 9    5.33  ctrl      <NA> no_large
## 10   5.14  ctrl      <NA> no_large
## 11   4.81  trt1      <NA>      yes
## 12   4.17  trt1      <NA>      yes
## 13   4.41  trt1      <NA>      yes
## 14   3.59  trt1      <NA>      yes
## 15   5.87  trt1      <NA>      yes
## 16   3.83  trt1      <NA>      yes
## 17   6.03  trt1      <NA>      yes
## 18   4.89  trt1      <NA>      yes
## 19   4.32  trt1      <NA>      yes
## 20   4.69  trt1      <NA>      yes
## 21   6.31  trt2      <NA>      yes
## 22   5.12  trt2      <NA>      yes
## 23   5.54  trt2      <NA>      yes
## 24   5.50  trt2      <NA>      yes
## 25   5.37  trt2      <NA>      yes
## 26   5.29  trt2      <NA>      yes
## 27   4.92  trt2      <NA>      yes
## 28   6.15  trt2      <NA>      yes
## 29   5.80  trt2      <NA>      yes
## 30   5.26  trt2      <NA>      yes
```

## 15.14.Recoding a Continuous Variable to a Categorical Variable

```r
# Work on a subset of the PlantGrowth data set
pg <- PlantGrowth[c(1, 2, 11, 21, 22), ]
pg
```

```
##    weight group
## 1    4.17  ctrl
## 2    5.58  ctrl
## 11   4.81  trt1
## 21   6.31  trt2
## 22   5.12  trt2
```

```r

pg$wtclass <- cut(pg$weight, breaks = c(0, 5, 6, Inf))
pg
```

```
##    weight group wtclass
## 1    4.17  ctrl   (0,5]
## 2    5.58  ctrl   (5,6]
## 11   4.81  trt1   (0,5]
## 21   6.31  trt2 (6,Inf]
## 22   5.12  trt2   (5,6]
```

```r

pg$wtclass <- cut(pg$weight, breaks = c(0, 5, 6, Inf), labels = c("small", "medium", 
    "large"))
pg
```

```
##    weight group wtclass
## 1    4.17  ctrl   small
## 2    5.58  ctrl  medium
## 11   4.81  trt1   small
## 21   6.31  trt2   large
## 22   5.12  trt2  medium
```

```r

cut(pg$weight, breaks = c(0, 5, 6, Inf), right = FALSE)
```

```
## [1] [0,5)   [5,6)   [0,5)   [6,Inf) [5,6)  
## Levels: [0,5) [5,6) [6,Inf)
```

## 15.15.Transforming Variables

```r
library(gcookbook)  # For the data set
# Make a copy of the data
hw <- heightweight
head(hw)
```

```
##   sex ageYear ageMonth heightIn weightLb
## 1   f   11.92      143     56.3     85.0
## 2   f   12.92      155     62.3    105.0
## 3   f   12.75      153     63.3    108.0
## 4   f   13.42      161     59.0     92.0
## 5   f   15.92      191     62.5    112.5
## 6   f   14.25      171     62.5    112.0
```

```r

hw$heightCm <- hw$heightIn * 2.54
head(hw)
```

```
##   sex ageYear ageMonth heightIn weightLb heightCm
## 1   f   11.92      143     56.3     85.0    143.0
## 2   f   12.92      155     62.3    105.0    158.2
## 3   f   12.75      153     63.3    108.0    160.8
## 4   f   13.42      161     59.0     92.0    149.9
## 5   f   15.92      191     62.5    112.5    158.8
## 6   f   14.25      171     62.5    112.0    158.8
```

```r

hw <- transform(hw, heightCm = heightIn * 2.54, weightKg = weightLb/2.204)
library(plyr)
hw <- mutate(hw, heightCm = heightIn * 2.54, weightKg = weightLb/2.204)
head(hw)
```

```
##   sex ageYear ageMonth heightIn weightLb heightCm weightKg
## 1   f   11.92      143     56.3     85.0    143.0    38.57
## 2   f   12.92      155     62.3    105.0    158.2    47.64
## 3   f   12.75      153     63.3    108.0    160.8    49.00
## 4   f   13.42      161     59.0     92.0    149.9    41.74
## 5   f   15.92      191     62.5    112.5    158.8    51.04
## 6   f   14.25      171     62.5    112.0    158.8    50.82
```

```r

# These all have the same effect:
hw <- transform(hw, bmi = weightKg/(heightCm/100)^2)
hw <- mutate(hw, bmi = weightKg/(heightCm/100)^2)
hw$bmi <- hw$weightKg/(hw$heightCm/100)^2
head(hw)
```

```
##   sex ageYear ageMonth heightIn weightLb heightCm weightKg   bmi
## 1   f   11.92      143     56.3     85.0    143.0    38.57 18.86
## 2   f   12.92      155     62.3    105.0    158.2    47.64 19.03
## 3   f   12.75      153     63.3    108.0    160.8    49.00 18.96
## 4   f   13.42      161     59.0     92.0    149.9    41.74 18.59
## 5   f   15.92      191     62.5    112.5    158.8    51.04 20.25
## 6   f   14.25      171     62.5    112.0    158.8    50.82 20.16
```

```r

hw <- heightweight
hw <- mutate(hw, heightCm = heightIn * 2.54, weightKg = weightLb/2.204, bmi = weightKg/(heightCm/100)^2)
```

## 15.16.Transforming variables by Group

```r
library(MASS)  # For the data set
library(plyr)
cb <- ddply(cabbages, "Cult", transform, DevWt = HeadWt - mean(HeadWt))

cabbages
```

```
##    Cult Date HeadWt VitC
## 1   c39  d16    2.5   51
## 2   c39  d16    2.2   55
## 3   c39  d16    3.1   45
## 4   c39  d16    4.3   42
## 5   c39  d16    2.5   53
## 6   c39  d16    4.3   50
## 7   c39  d16    3.8   50
## 8   c39  d16    4.3   52
## 9   c39  d16    1.7   56
## 10  c39  d16    3.1   49
## 11  c39  d20    3.0   65
## 12  c39  d20    2.8   52
## 13  c39  d20    2.8   41
## 14  c39  d20    2.7   51
## 15  c39  d20    2.6   41
## 16  c39  d20    2.8   45
## 17  c39  d20    2.6   51
## 18  c39  d20    2.6   45
## 19  c39  d20    2.6   61
## 20  c39  d20    3.5   42
## 21  c39  d21    2.2   54
## 22  c39  d21    1.8   59
## 23  c39  d21    1.6   66
## 24  c39  d21    2.1   54
## 25  c39  d21    3.3   45
## 26  c39  d21    3.8   49
## 27  c39  d21    3.2   49
## 28  c39  d21    3.6   55
## 29  c39  d21    4.2   49
## 30  c39  d21    1.6   68
## 31  c52  d16    2.0   58
## 32  c52  d16    2.4   55
## 33  c52  d16    1.9   67
## 34  c52  d16    2.8   61
## 35  c52  d16    1.7   67
## 36  c52  d16    3.2   68
## 37  c52  d16    2.0   58
## 38  c52  d16    2.2   63
## 39  c52  d16    2.2   56
## 40  c52  d16    2.2   72
## 41  c52  d20    4.0   52
## 42  c52  d20    2.8   70
## 43  c52  d20    3.1   57
## 44  c52  d20    4.2   58
## 45  c52  d20    3.7   47
## 46  c52  d20    3.0   56
## 47  c52  d20    2.2   72
## 48  c52  d20    2.3   63
## 49  c52  d20    3.8   54
## 50  c52  d20    2.0   60
## 51  c52  d21    1.5   78
## 52  c52  d21    1.4   75
## 53  c52  d21    1.7   70
## 54  c52  d21    1.3   84
## 55  c52  d21    1.7   71
## 56  c52  d21    1.6   72
## 57  c52  d21    1.4   62
## 58  c52  d21    1.0   68
## 59  c52  d21    1.5   66
## 60  c52  d21    1.6   72
```

```r

transform(cabbages, DevWt = HeadWt - mean(HeadWt))
```

```
##    Cult Date HeadWt VitC     DevWt
## 1   c39  d16    2.5   51 -0.093333
## 2   c39  d16    2.2   55 -0.393333
## 3   c39  d16    3.1   45  0.506667
## 4   c39  d16    4.3   42  1.706667
## 5   c39  d16    2.5   53 -0.093333
## 6   c39  d16    4.3   50  1.706667
## 7   c39  d16    3.8   50  1.206667
## 8   c39  d16    4.3   52  1.706667
## 9   c39  d16    1.7   56 -0.893333
## 10  c39  d16    3.1   49  0.506667
## 11  c39  d20    3.0   65  0.406667
## 12  c39  d20    2.8   52  0.206667
## 13  c39  d20    2.8   41  0.206667
## 14  c39  d20    2.7   51  0.106667
## 15  c39  d20    2.6   41  0.006667
## 16  c39  d20    2.8   45  0.206667
## 17  c39  d20    2.6   51  0.006667
## 18  c39  d20    2.6   45  0.006667
## 19  c39  d20    2.6   61  0.006667
## 20  c39  d20    3.5   42  0.906667
## 21  c39  d21    2.2   54 -0.393333
## 22  c39  d21    1.8   59 -0.793333
## 23  c39  d21    1.6   66 -0.993333
## 24  c39  d21    2.1   54 -0.493333
## 25  c39  d21    3.3   45  0.706667
## 26  c39  d21    3.8   49  1.206667
## 27  c39  d21    3.2   49  0.606667
## 28  c39  d21    3.6   55  1.006667
## 29  c39  d21    4.2   49  1.606667
## 30  c39  d21    1.6   68 -0.993333
## 31  c52  d16    2.0   58 -0.593333
## 32  c52  d16    2.4   55 -0.193333
## 33  c52  d16    1.9   67 -0.693333
## 34  c52  d16    2.8   61  0.206667
## 35  c52  d16    1.7   67 -0.893333
## 36  c52  d16    3.2   68  0.606667
## 37  c52  d16    2.0   58 -0.593333
## 38  c52  d16    2.2   63 -0.393333
## 39  c52  d16    2.2   56 -0.393333
## 40  c52  d16    2.2   72 -0.393333
## 41  c52  d20    4.0   52  1.406667
## 42  c52  d20    2.8   70  0.206667
## 43  c52  d20    3.1   57  0.506667
## 44  c52  d20    4.2   58  1.606667
## 45  c52  d20    3.7   47  1.106667
## 46  c52  d20    3.0   56  0.406667
## 47  c52  d20    2.2   72 -0.393333
## 48  c52  d20    2.3   63 -0.293333
## 49  c52  d20    3.8   54  1.206667
## 50  c52  d20    2.0   60 -0.593333
## 51  c52  d21    1.5   78 -1.093333
## 52  c52  d21    1.4   75 -1.193333
## 53  c52  d21    1.7   70 -0.893333
## 54  c52  d21    1.3   84 -1.293333
## 55  c52  d21    1.7   71 -0.893333
## 56  c52  d21    1.6   72 -0.993333
## 57  c52  d21    1.4   62 -1.193333
## 58  c52  d21    1.0   68 -1.593333
## 59  c52  d21    1.5   66 -1.093333
## 60  c52  d21    1.6   72 -0.993333
```

```r

library(plyr)
cb <- ddply(cabbages, "Cult", transform, DevWt = HeadWt - mean(HeadWt))
cb
```

```
##    Cult Date HeadWt VitC    DevWt
## 1   c39  d16    2.5   51 -0.40667
## 2   c39  d16    2.2   55 -0.70667
## 3   c39  d16    3.1   45  0.19333
## 4   c39  d16    4.3   42  1.39333
## 5   c39  d16    2.5   53 -0.40667
## 6   c39  d16    4.3   50  1.39333
## 7   c39  d16    3.8   50  0.89333
## 8   c39  d16    4.3   52  1.39333
## 9   c39  d16    1.7   56 -1.20667
## 10  c39  d16    3.1   49  0.19333
## 11  c39  d20    3.0   65  0.09333
## 12  c39  d20    2.8   52 -0.10667
## 13  c39  d20    2.8   41 -0.10667
## 14  c39  d20    2.7   51 -0.20667
## 15  c39  d20    2.6   41 -0.30667
## 16  c39  d20    2.8   45 -0.10667
## 17  c39  d20    2.6   51 -0.30667
## 18  c39  d20    2.6   45 -0.30667
## 19  c39  d20    2.6   61 -0.30667
## 20  c39  d20    3.5   42  0.59333
## 21  c39  d21    2.2   54 -0.70667
## 22  c39  d21    1.8   59 -1.10667
## 23  c39  d21    1.6   66 -1.30667
## 24  c39  d21    2.1   54 -0.80667
## 25  c39  d21    3.3   45  0.39333
## 26  c39  d21    3.8   49  0.89333
## 27  c39  d21    3.2   49  0.29333
## 28  c39  d21    3.6   55  0.69333
## 29  c39  d21    4.2   49  1.29333
## 30  c39  d21    1.6   68 -1.30667
## 31  c52  d16    2.0   58 -0.28000
## 32  c52  d16    2.4   55  0.12000
## 33  c52  d16    1.9   67 -0.38000
## 34  c52  d16    2.8   61  0.52000
## 35  c52  d16    1.7   67 -0.58000
## 36  c52  d16    3.2   68  0.92000
## 37  c52  d16    2.0   58 -0.28000
## 38  c52  d16    2.2   63 -0.08000
## 39  c52  d16    2.2   56 -0.08000
## 40  c52  d16    2.2   72 -0.08000
## 41  c52  d20    4.0   52  1.72000
## 42  c52  d20    2.8   70  0.52000
## 43  c52  d20    3.1   57  0.82000
## 44  c52  d20    4.2   58  1.92000
## 45  c52  d20    3.7   47  1.42000
## 46  c52  d20    3.0   56  0.72000
## 47  c52  d20    2.2   72 -0.08000
## 48  c52  d20    2.3   63  0.02000
## 49  c52  d20    3.8   54  1.52000
## 50  c52  d20    2.0   60 -0.28000
## 51  c52  d21    1.5   78 -0.78000
## 52  c52  d21    1.4   75 -0.88000
## 53  c52  d21    1.7   70 -0.58000
## 54  c52  d21    1.3   84 -0.98000
## 55  c52  d21    1.7   71 -0.58000
## 56  c52  d21    1.6   72 -0.68000
## 57  c52  d21    1.4   62 -0.88000
## 58  c52  d21    1.0   68 -1.28000
## 59  c52  d21    1.5   66 -0.78000
## 60  c52  d21    1.6   72 -0.68000
```

```r

# The data before normalizing
ggplot(cb, aes(x = Cult, y = HeadWt)) + geom_boxplot()
```

```
## Error: 没有"ggplot"这个函数
```

```r

# After normalizing
ggplot(cb, aes(x = Cult, y = DevWt)) + geom_boxplot()
```

```
## Error: 没有"ggplot"这个函数
```

```r


ddply(cabbages, c("Cult", "Date"), transform, DevWt = HeadWt - mean(HeadWt), 
    DevVitC = VitC - mean(VitC))
```

```
##    Cult Date HeadWt VitC DevWt DevVitC
## 1   c39  d16    2.5   51 -0.68     0.7
## 2   c39  d16    2.2   55 -0.98     4.7
## 3   c39  d16    3.1   45 -0.08    -5.3
## 4   c39  d16    4.3   42  1.12    -8.3
## 5   c39  d16    2.5   53 -0.68     2.7
## 6   c39  d16    4.3   50  1.12    -0.3
## 7   c39  d16    3.8   50  0.62    -0.3
## 8   c39  d16    4.3   52  1.12     1.7
## 9   c39  d16    1.7   56 -1.48     5.7
## 10  c39  d16    3.1   49 -0.08    -1.3
## 11  c39  d20    3.0   65  0.20    15.6
## 12  c39  d20    2.8   52  0.00     2.6
## 13  c39  d20    2.8   41  0.00    -8.4
## 14  c39  d20    2.7   51 -0.10     1.6
## 15  c39  d20    2.6   41 -0.20    -8.4
## 16  c39  d20    2.8   45  0.00    -4.4
## 17  c39  d20    2.6   51 -0.20     1.6
## 18  c39  d20    2.6   45 -0.20    -4.4
## 19  c39  d20    2.6   61 -0.20    11.6
## 20  c39  d20    3.5   42  0.70    -7.4
## 21  c39  d21    2.2   54 -0.54    -0.8
## 22  c39  d21    1.8   59 -0.94     4.2
## 23  c39  d21    1.6   66 -1.14    11.2
## 24  c39  d21    2.1   54 -0.64    -0.8
## 25  c39  d21    3.3   45  0.56    -9.8
## 26  c39  d21    3.8   49  1.06    -5.8
## 27  c39  d21    3.2   49  0.46    -5.8
## 28  c39  d21    3.6   55  0.86     0.2
## 29  c39  d21    4.2   49  1.46    -5.8
## 30  c39  d21    1.6   68 -1.14    13.2
## 31  c52  d16    2.0   58 -0.26    -4.5
## 32  c52  d16    2.4   55  0.14    -7.5
## 33  c52  d16    1.9   67 -0.36     4.5
## 34  c52  d16    2.8   61  0.54    -1.5
## 35  c52  d16    1.7   67 -0.56     4.5
## 36  c52  d16    3.2   68  0.94     5.5
## 37  c52  d16    2.0   58 -0.26    -4.5
## 38  c52  d16    2.2   63 -0.06     0.5
## 39  c52  d16    2.2   56 -0.06    -6.5
## 40  c52  d16    2.2   72 -0.06     9.5
## 41  c52  d20    4.0   52  0.89    -6.9
## 42  c52  d20    2.8   70 -0.31    11.1
## 43  c52  d20    3.1   57 -0.01    -1.9
## 44  c52  d20    4.2   58  1.09    -0.9
## 45  c52  d20    3.7   47  0.59   -11.9
## 46  c52  d20    3.0   56 -0.11    -2.9
## 47  c52  d20    2.2   72 -0.91    13.1
## 48  c52  d20    2.3   63 -0.81     4.1
## 49  c52  d20    3.8   54  0.69    -4.9
## 50  c52  d20    2.0   60 -1.11     1.1
## 51  c52  d21    1.5   78  0.03     6.2
## 52  c52  d21    1.4   75 -0.07     3.2
## 53  c52  d21    1.7   70  0.23    -1.8
## 54  c52  d21    1.3   84 -0.17    12.2
## 55  c52  d21    1.7   71  0.23    -0.8
## 56  c52  d21    1.6   72  0.13     0.2
## 57  c52  d21    1.4   62 -0.07    -9.8
## 58  c52  d21    1.0   68 -0.47    -3.8
## 59  c52  d21    1.5   66  0.03    -5.8
## 60  c52  d21    1.6   72  0.13     0.2
```

## 15.17.Summarizing Data by Groups

```r
library(MASS)  # For the data set
library(plyr)

ddply(cabbages, c("Cult", "Date"), summarise, Weight = mean(HeadWt), VitC = mean(VitC))
```

```
##   Cult Date Weight VitC
## 1  c39  d16   3.18 50.3
## 2  c39  d20   2.80 49.4
## 3  c39  d21   2.74 54.8
## 4  c52  d16   2.26 62.5
## 5  c52  d20   3.11 58.9
## 6  c52  d21   1.47 71.8
```

```r

head(cabbages)
```

```
##   Cult Date HeadWt VitC
## 1  c39  d16    2.5   51
## 2  c39  d16    2.2   55
## 3  c39  d16    3.1   45
## 4  c39  d16    4.3   42
## 5  c39  d16    2.5   53
## 6  c39  d16    4.3   50
```

```r

library(plyr)
summarise(cabbages, Weight = mean(HeadWt))
```

```
##   Weight
## 1  2.593
```

```r

library(plyr)
ddply(cabbages, "Cult", summarise, Weight = mean(HeadWt))
```

```
##   Cult Weight
## 1  c39  2.907
## 2  c52  2.280
```

```r

ddply(cabbages, c("Cult", "Date"), summarise, Weight = mean(HeadWt), VitC = mean(VitC))
```

```
##   Cult Date Weight VitC
## 1  c39  d16   3.18 50.3
## 2  c39  d20   2.80 49.4
## 3  c39  d21   2.74 54.8
## 4  c52  d16   2.26 62.5
## 5  c52  d20   3.11 58.9
## 6  c52  d21   1.47 71.8
```

```r

ddply(cabbages, c("Cult", "Date"), summarise, Weight = mean(HeadWt), sd = sd(HeadWt), 
    n = length(HeadWt))
```

```
##   Cult Date Weight     sd  n
## 1  c39  d16   3.18 0.9566 10
## 2  c39  d20   2.80 0.2789 10
## 3  c39  d21   2.74 0.9834 10
## 4  c52  d16   2.26 0.4452 10
## 5  c52  d20   3.11 0.7909 10
## 6  c52  d21   1.47 0.2111 10
```

```r

c1 <- cabbages  # Make a copy
c1$HeadWt[c(1, 20, 45)] <- NA  # Set some values to NA

ddply(c1, c("Cult", "Date"), summarise, Weight = mean(HeadWt), sd = sd(HeadWt), 
    n = length(HeadWt))
```

```
##   Cult Date Weight     sd  n
## 1  c39  d16     NA     NA 10
## 2  c39  d20     NA     NA 10
## 3  c39  d21   2.74 0.9834 10
## 4  c52  d16   2.26 0.4452 10
## 5  c52  d20     NA     NA 10
## 6  c52  d21   1.47 0.2111 10
```

```r

ddply(c1, c("Cult", "Date"), summarise, Weight = mean(HeadWt, na.rm = TRUE), 
    sd = sd(HeadWt, na.rm = TRUE), n = sum(!is.na(HeadWt)))
```

```
##   Cult Date Weight     sd  n
## 1  c39  d16  3.256 0.9825  9
## 2  c39  d20  2.722 0.1394  9
## 3  c39  d21  2.740 0.9834 10
## 4  c52  d16  2.260 0.4452 10
## 5  c52  d20  3.044 0.8095  9
## 6  c52  d21  1.470 0.2111 10
```

```r

# Copy cabbages and remove all rows with both c52 and d21
c2 <- subset(c1, !(Cult == "c52" & Date == "d21"))

c2a <- ddply(c2, c("Cult", "Date"), summarise, Weight = mean(HeadWt, na.rm = TRUE), 
    sd = sd(HeadWt, na.rm = TRUE), n = sum(!is.na(HeadWt)))
c2a
```

```
##   Cult Date Weight     sd  n
## 1  c39  d16  3.256 0.9825  9
## 2  c39  d20  2.722 0.1394  9
## 3  c39  d21  2.740 0.9834 10
## 4  c52  d16  2.260 0.4452 10
## 5  c52  d20  3.044 0.8095  9
```

```r

# Make the graph
ggplot(c2a, aes(x = Date, fill = Cult, y = Weight)) + geom_bar(position = "dodge")
```

```
## Error: 没有"ggplot"这个函数
```

```r


c2b <- ddply(c2, c("Cult", "Date"), .drop = FALSE, summarise, Weight = mean(HeadWt, 
    na.rm = TRUE), sd = sd(HeadWt, na.rm = TRUE), n = sum(!is.na(HeadWt)))
c2b
```

```
##   Cult Date Weight     sd  n
## 1  c39  d16  3.256 0.9825  9
## 2  c39  d20  2.722 0.1394  9
## 3  c39  d21  2.740 0.9834 10
## 4  c52  d16  2.260 0.4452 10
## 5  c52  d20  3.044 0.8095  9
## 6  c52  d21    NaN     NA  0
```

```r

# Make the graph
ggplot(c2b, aes(x = Date, fill = Cult, y = Weight)) + geom_bar(position = "dodge")
```

```
## Error: 没有"ggplot"这个函数
```

## 15.18.Summarizing Data with Standard Errors and Confidence Intervals

```r
library(MASS)  # For the data set
library(plyr)

ca <- ddply(cabbages, c("Cult", "Date"), summarise, Weight = mean(HeadWt, na.rm = TRUE), 
    sd = sd(HeadWt, na.rm = TRUE), n = sum(!is.na(HeadWt)), se = sd/sqrt(n))

ca
```

```
##   Cult Date Weight     sd  n      se
## 1  c39  d16   3.18 0.9566 10 0.30251
## 2  c39  d20   2.80 0.2789 10 0.08819
## 3  c39  d21   2.74 0.9834 10 0.31098
## 4  c52  d16   2.26 0.4452 10 0.14079
## 5  c52  d20   3.11 0.7909 10 0.25009
## 6  c52  d21   1.47 0.2111 10 0.06675
```

```r

ddply(cabbages, c("Cult", "Date"), summarise, Weight = mean(HeadWt, na.rm = TRUE), 
    sd = sd(HeadWt, na.rm = TRUE), n = sum(!is.na(HeadWt)), se = sd/sqrt(n))
```

```
##   Cult Date Weight     sd  n      se
## 1  c39  d16   3.18 0.9566 10 0.30251
## 2  c39  d20   2.80 0.2789 10 0.08819
## 3  c39  d21   2.74 0.9834 10 0.31098
## 4  c52  d16   2.26 0.4452 10 0.14079
## 5  c52  d20   3.11 0.7909 10 0.25009
## 6  c52  d21   1.47 0.2111 10 0.06675
```

```r


ciMult <- qt(0.975, ca$n - 1)
ciMult
```

```
## [1] 2.262 2.262 2.262 2.262 2.262 2.262
```

```r

ca$ci <- ca$se * ciMult

ca$ci95 <- ca$se * qt(0.975, ca$n)


summarySE <- function(data = NULL, measurevar, groupvars = NULL, conf.interval = 0.95, 
    na.rm = FALSE, .drop = TRUE) {
    require(plyr)
    
    # New version of length that can handle NAs: if na.rm==T, don't count them
    length2 <- function(x, na.rm = FALSE) {
        if (na.rm) 
            sum(!is.na(x)) else length(x)
    }
    
    # This does the summary
    datac <- ddply(data, groupvars, .drop = .drop, .fun = function(xx, col, 
        na.rm) {
        c(n = length2(xx[, col], na.rm = na.rm), mean = mean(xx[, col], na.rm = na.rm), 
            sd = sd(xx[, col], na.rm = na.rm))
    }, measurevar, na.rm)
    
    # Rename the 'mean' column
    datac <- rename(datac, c(mean = measurevar))
    
    datac$se <- datac$sd/sqrt(datac$n)  # Calculate standard error of the mean
    
    # Confidence interval multiplier for standard error Calculate t-statistic
    # for confidence interval: e.g., if conf.interval is .95, use .975
    # (above/below), and use df=n-1, or if n==0, use df=0
    ciMult <- qt(conf.interval/2 + 0.5, datac$n - 1)
    datac$ci <- datac$se * ciMult
    
    return(datac)
}

# Remove all rows with both c52 and d21
c2 <- subset(cabbages, !(Cult == "c52" & Date == "d21"))

# Set some values to NA
c2$HeadWt[c(1, 20, 45)] <- NA


summarySE(c2, "HeadWt", c("Cult", "Date"), conf.interval = 0.99, na.rm = TRUE, 
    .drop = FALSE)
```

```
## Warning: 产生了NaNs
```

```
##   Cult Date  n HeadWt     sd      se     ci
## 1  c39  d16  9  3.256 0.9825 0.32750 1.0989
## 2  c39  d20  9  2.722 0.1394 0.04648 0.1560
## 3  c39  d21 10  2.740 0.9834 0.31098 1.0106
## 4  c52  d16 10  2.260 0.4452 0.14079 0.4575
## 5  c52  d20  9  3.044 0.8095 0.26983 0.9054
## 6  c52  d21  0    NaN     NA      NA     NA
```

## 15.19.Converting Data from Wide to Long

```r
library(gcookbook)  # For the data set
anthoming
```

```
##   Angle Experimental Control
## 1   -20            1       0
## 2   -10            7       3
## 3     0            2       3
## 4    10            0       3
## 5    20            0       1
```

```r

library(reshape2)
melt(anthoming, id.vars = "angle", variable.name = "condition", value.name = "count")
```

```
## Error: id variables not found in data: angle
```

```r

drunk
```

```
##      sex 0-29 30-39 40-49 50-59 60+
## 1   male  185   207   260   180  71
## 2 female    4    13    10     7  10
```

```r

melt(drunk, id.vars = "sex", measure.vars = c("0-29", "30-39"), variable.name = "age", 
    value.name = "count")
```

```
##      sex   age count
## 1   male  0-29   185
## 2 female  0-29     4
## 3   male 30-39   207
## 4 female 30-39    13
```

```r

plum_wide
```

```
##   length      time dead alive
## 1   long   at_once   84   156
## 2   long in_spring  156    84
## 3  short   at_once  133   107
## 4  short in_spring  209    31
```

```r

melt(plum_wide, id.vars = c("length", "time"), variable.name = "survival", value.name = "count")
```

```
##   length      time survival count
## 1   long   at_once     dead    84
## 2   long in_spring     dead   156
## 3  short   at_once     dead   133
## 4  short in_spring     dead   209
## 5   long   at_once    alive   156
## 6   long in_spring    alive    84
## 7  short   at_once    alive   107
## 8  short in_spring    alive    31
```

```r

# Make a copy of the data
co <- corneas
co
```

```
##   affected notaffected
## 1      488         484
## 2      478         478
## 3      480         492
## 4      426         444
## 5      440         436
## 6      410         398
## 7      458         464
## 8      460         476
```

```r

# Add an ID column
co$id <- 1:nrow(co)

melt(co, id.vars = "id", variable.name = "eye", value.name = "thickness")
```

```
##    id         eye thickness
## 1   1    affected       488
## 2   2    affected       478
## 3   3    affected       480
## 4   4    affected       426
## 5   5    affected       440
## 6   6    affected       410
## 7   7    affected       458
## 8   8    affected       460
## 9   1 notaffected       484
## 10  2 notaffected       478
## 11  3 notaffected       492
## 12  4 notaffected       444
## 13  5 notaffected       436
## 14  6 notaffected       398
## 15  7 notaffected       464
## 16  8 notaffected       476
```

## 15.20.Converting Data from Long to Wide

```r
library(gcookbook)  # For the data set
plum
```

```
##   length      time survival count
## 1   long   at_once     dead    84
## 2   long in_spring     dead   156
## 3  short   at_once     dead   133
## 4  short in_spring     dead   209
## 5   long   at_once    alive   156
## 6   long in_spring    alive    84
## 7  short   at_once    alive   107
## 8  short in_spring    alive    31
```

```r

library(reshape2)
dcast(plum, length + time ~ survival, value.var = "count")
```

```
##   length      time dead alive
## 1   long   at_once   84   156
## 2   long in_spring  156    84
## 3  short   at_once  133   107
## 4  short in_spring  209    31
```

```r

dcast(plum, time ~ length + survival, value.var = "count")
```

```
##        time long_dead long_alive short_dead short_alive
## 1   at_once        84        156        133         107
## 2 in_spring       156         84        209          31
```

## 15.21.Converting a Time Series Object to Times

```r
# Look at nhtemp Time Series object
nhtemp
```

```
## Time Series:
## Start = 1912 
## End = 1971 
## Frequency = 1 
##  [1] 49.9 52.3 49.4 51.1 49.4 47.9 49.8 50.9 49.3 51.9 50.8 49.6 49.3 50.6
## [15] 48.4 50.7 50.9 50.6 51.5 52.8 51.8 51.1 49.8 50.2 50.4 51.6 51.8 50.9
## [29] 48.8 51.7 51.0 50.6 51.7 51.5 52.1 51.3 51.0 54.0 51.4 52.7 53.1 54.6
## [43] 52.0 52.0 50.9 52.6 50.2 52.6 51.6 51.9 50.5 50.9 51.7 51.4 51.7 50.8
## [57] 51.9 51.8 51.9 53.0
```

```r

# Get times for each observation
as.numeric(time(nhtemp))
```

```
##  [1] 1912 1913 1914 1915 1916 1917 1918 1919 1920 1921 1922 1923 1924 1925
## [15] 1926 1927 1928 1929 1930 1931 1932 1933 1934 1935 1936 1937 1938 1939
## [29] 1940 1941 1942 1943 1944 1945 1946 1947 1948 1949 1950 1951 1952 1953
## [43] 1954 1955 1956 1957 1958 1959 1960 1961 1962 1963 1964 1965 1966 1967
## [57] 1968 1969 1970 1971
```

```r

# Get value of each observation
as.numeric(nhtemp)
```

```
##  [1] 49.9 52.3 49.4 51.1 49.4 47.9 49.8 50.9 49.3 51.9 50.8 49.6 49.3 50.6
## [15] 48.4 50.7 50.9 50.6 51.5 52.8 51.8 51.1 49.8 50.2 50.4 51.6 51.8 50.9
## [29] 48.8 51.7 51.0 50.6 51.7 51.5 52.1 51.3 51.0 54.0 51.4 52.7 53.1 54.6
## [43] 52.0 52.0 50.9 52.6 50.2 52.6 51.6 51.9 50.5 50.9 51.7 51.4 51.7 50.8
## [57] 51.9 51.8 51.9 53.0
```

```r

# Put them in a data frame
nht <- data.frame(year = as.numeric(time(nhtemp)), temp = as.numeric(nhtemp))
head(nht)
```

```
##   year temp
## 1 1912 49.9
## 2 1913 52.3
## 3 1914 49.4
## 4 1915 51.1
## 5 1916 49.4
## 6 1917 47.9
```

```r

head(presidents)
```

```
## [1] NA 87 82 75 63 50
```

```r

pres_rating <- data.frame(year = as.numeric(time(presidents)), rating = as.numeric(presidents))
head(pres_rating)
```

```
##   year rating
## 1 1945     NA
## 2 1945     87
## 3 1946     82
## 4 1946     75
## 5 1946     63
## 6 1946     50
```

```r

pres_rating2 <- data.frame(year = as.numeric(floor(time(presidents))), quarter = as.numeric(cycle(presidents)), 
    rating = as.numeric(presidents))
head(pres_rating2)
```

```
##   year quarter rating
## 1 1945       1     NA
## 2 1945       2     87
## 3 1945       3     82
## 4 1945       4     75
## 5 1946       1     63
## 6 1946       2     50
```

